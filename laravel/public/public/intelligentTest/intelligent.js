define("nowcoder/1.2.348/javascripts/site/contest/intelligent",["../../lib/jquery","../../lib/underscore","../../core/base","../../util/util","../../util/cookie","../../component/popup","../../core/component","../../util/event","../../component/layer","../../util/dragdrop","../../util/browser","../../component/checkgroup","../../component/checkbox"],function(a){function b(){var a=this;a.isLogin=!!(window.globalInfo||{}).ownerId,a.difficulty=3,a.tagMap={},a.tagContainer=m("#jsTagContainer"),a.form=m("#jsGoPractice").closest("form"),a.difficultyEl=m("#jsDifficultyShow"),a.tagShowEl=m("#jsTagsShow"),a.tags=(window.tags||[]).slice(0),a.countDv=m("#jsCountChk"),a.leftQuestionCount=0,a.renderTag(),a.initCountChk()}function c(){var a=this;a.countChk=r.mix({el:m("label.radio"),listeners:{change:function(){a.lastSelectCount=window.parseInt(a.countChk.val(),10)||10,p.set("intelligentSelectCount",a.lastSelectCount,!0),a.changeAction()}}}),a.lastSelectCount=+p.get("intelligentSelectCount")||10}function d(a){var b=this;if(!b.isLogin)return a.preventDefault(),void 0;var c=b.getIds();return 0===c.length?(a.preventDefault(),q.alert("请先选择标签"),void 0):void 0}function e(){var a=this,b=0,c=[];n.forEach(a.getIds(),function(d){var e=a.tagMap[d];c.push(e.title),b+=e.leftcount}),a.tagShowEl.html(c.join(", "));var d=0===c.length?"":" | ",e=d+("一二三四五".split("")[a.difficulty-1]||"三")+"星难度";if(a.form.length>0){var f=window.parseInt(a.countChk.val(),10)||10;f=a.getQuestionCount(f,b),a.countDv[10>b?"hide":"show"](),a.countChk.option[2].getEl()[20>b?"hide":"show"](),a.countChk.option[3].getEl()[30>b?"hide":"show"](),a.countChk.val(f+""),e+=" | "+f+"题";var g=p.addParam({tagIds:a.getIds().join(","),difficulty:a.difficulty,questionCount:f},"/makePaper");a.form.attr("action",g)}a.difficultyEl.html(e)}function f(a){var b=this,c=m(a.currentTarget),d=a.clientX,e=c.offset().left,f=d-e,g=Math.max(1,Math.ceil(f/23));b.difficulty!==g&&(g=1>g?1:g>5?5:g,g=n.contains([1,2,3,4,5],g)?g:3,b.difficulty=g,c.removeClass().addClass("stars-choose star-"+g),b.changeAction())}function g(){var a=this;a.tagContainer.find("label.checked").removeClass("checked"),a.changeAction()}function h(a){a.preventDefault();var b=this;if(b.isLogin){var c=m(a.currentTarget),d=c.find("label.checkbox"),e=c.closest("dl"),f=e.find("dt.pop-interest-head label.checkbox"),g=c.attr("data-id");if(g){if(d.hasClass("checked"))d.removeClass("checked"),f.removeClass("checked");else{d.addClass("checked");var h=!0;n.every(e.find("dd.pop-interest-info label.checkbox"),function(a){return h=h&&m(a).hasClass("checked")}),h&&f.addClass("checked")}b.changeAction()}}}function i(a){a.preventDefault();var b=this;if(b.isLogin){var c=m(a.currentTarget),d=c.closest("dl");c.hasClass("checked")?(c.removeClass("checked"),d.find("label.checked").removeClass("checked")):(c.addClass("checked"),d.find("label.checkbox").addClass("checked")),b.changeAction()}}function j(){var a=this,b=a.tags;b.sort(function(a,b){return a.items.length-b.items.length});var c="";n.forEach(b,function(b){c+=['<dl class="pop-interest-type">','<dt class="pop-interest-head">','<label class="checkbox nc-req-auth">','<span class="icons"></span>','<input type="checkbox" data-toggle="checkbox" /> 全选',"</label>","<h2>",b.title,"</h2>","</dt>"].join(""),n.forEach(b.items,function(b){a.tagMap[b.id+""]=b;var d=0===b.tcount?0:b.rcount===b.tcount?100:100*b.rcount/b.tcount;c+=['<dd class="pop-interest-info nc-req-auth" data-id="'+b.id+'">','<label class="checkbox">','<span class="icons"></span>','<input type="checkbox" data-toggle="checkbox">','<div class="pop-interest-tit" title="'+b.title+'">'+b.title+"</div>","</label>",'<div class="data-progress-bg">','<div class="data-progress-bar red-bar" style="width:'+d+'%;"></div>',"</div>",'<span class="data-progress-txt">'+b.rcount+"/"+b.tcount+"</span>","</dd>"].join("")}),c+="</dl>"}),a.tagContainer.html(c);for(var d=a.tagContainer.find("dl.pop-interest-type"),e=0,f=0,g=d.length;g>f;f++){var h=m(d[f]);e=Math.max(e,h.height());var i=(f+1)%3;if(0===i||f+1===g){i=0===i?3:i;for(var j=0;i>j;j++)m(d[f-j]).height(e);e=0}}}function k(a,b){var c=this;return a=c.lastSelectCount||a,b>=a?a:b>=20?20:b>=10?10:5}function l(){var a=this,b=a.tagContainer.find("dd.pop-interest-info label.checkbox.checked"),c=[];return n.forEach(b,function(a){a=m(a).closest("dd.pop-interest-info"),a.length>0&&a.attr("data-id")&&c.push(a.attr("data-id"))}),c}var m=a("../../lib/jquery"),n=a("../../lib/underscore"),o=a("../../core/base"),p=a("../../util/util"),q=a("../../component/popup"),r=a("../../component/checkgroup");o.ready({initialize:b,binds:{"click #jsReSelect":g,"click #jsGoPractice":d,"mousemove #jsDifficulty":f},events:{"click dd.pop-interest-info":h,"click dt.pop-interest-head label.checkbox":i},initCountChk:c,renderTag:j,changeAction:e,getQuestionCount:k,getIds:l})});
