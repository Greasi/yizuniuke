define("nowcoder/1.2.346/javascripts/site/login/register",["../../lib/jquery","../../core/base","../../lib/underscore","../../util/util","../../util/cookie","../../action/login","../../util/ajax","../../core/siteConfig","../../component/input","../../util/dom","../../util/browser","../../core/component","../../util/event","../../component/popup","../../component/layer","../../util/dragdrop"],function(a){function b(){var a=this;a.info={checkEmail:{}},a.emailItem=j.transform(f("#emailIpt").parent(),{blur:function(){var b=this,c=f.trim(b.val());if(a.info.email="",!h.isEmail(c))return this.errorTips("请输入正确的邮箱"),void 0;if(a.info.checkEmail[c])return this.errorTips("该邮箱已经被注册"),void 0;if(a.info.email=c,a.ajaxing!==c){if(0===a.info.checkEmail[c])return b.success(),void 0;a.ajaxing=c,i.checkEmail({query:{email:c},call:function(){a.info.checkEmail[c]=0,b.success()},error:function(d){1===d.code?(a.info.checkEmail[c]=1,a.emailItem.errorTips("该邮箱已经被注册"),a.info.email=""):b.none()},always:function(){a.ajaxing=null}})}}}),a.pwd1Item=j.transform(f("#passwordIpt").parent(),{focus:function(){a.pwd2Item.none()},blur:function(){a.blurPwd()}}),a.pwd2Item=j.transform(f("#passwordIpt2").parent(),{focus:function(){a.pwd1Item.none()},blur:function(){a.blurPwd()}}),f("#rqcodeIpt").length>0&&(a.rqCodeItem=j.transform(f("#rqcodeIpt").parent()))}function c(a){var b=f(a.currentTarget),c=f(b.closest("div.form-group")).find("img"),d=c.attr("src");d=h.addParam({t:(new Date).getTime()},d),c.attr("src",d)}function d(){var a=this,b=f.trim(a.pwd1Item.val()),c=f.trim(a.pwd2Item.val());""===b||""===c?(a.pwd1Item.none(),a.pwd2Item.none(),a.info.password=""):b===c?(a.pwd1Item.success(),a.pwd2Item.success(),a.info.password=b):(a.pwd1Item.errorTips("密码不一致"),a.pwd2Item.errorTips("密码不一致"),a.info.password="")}function e(a){a.preventDefault();var b=this;b.emailItem.blur(),b.pwd1Item.blur(),b.pwd2Item.blur();var c=b.info;if(!c.email){var d=b.emailItem.val();if(!h.isEmail(d))return b.emailItem.errorTips("请输入正确的邮箱"),void 0;if(b.info.checkEmail[d])return b.emailItem.errorTips("该邮箱已经被注册"),void 0}if(!c.password)return b.pwd1Item.errorTips("密码不一致"),b.pwd2Item.errorTips("密码不一致"),void 0;var e="";return b.rqCodeItem&&(e=f.trim(b.rqCodeItem.val()),""===e)?(b.rqCodeItem.errorTips("验证码不能为空"),void 0):(i.register({body:{email:c.email,pwd:c.password,captcha:e},call:function(){var a=h.getUrlCb("callBack");window.location.href=a||"/completeness"},error:function(a){return 9===a.code?(b.rqCodeItem.errorTips(a.msg),void 0):(b.emailItem.errorTips(a.msg||"注册失败，请重试"),void 0)}}),void 0)}var f=a("../../lib/jquery"),g=a("../../core/base"),h=a("../../util/util"),i=a("../../action/login"),j=a("../../component/input");a("../../component/popup"),g.ready({initialize:b,binds:{"click #registerBtn":e,"click div.form-group a.rq-refresh":c,"click div.form-group a.rq-img":c,"submit div.input-section form":e},blurPwd:d})});
