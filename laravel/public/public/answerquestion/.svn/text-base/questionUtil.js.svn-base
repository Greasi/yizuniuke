define("nowcoder/1.2.348/javascripts/site/question/questionUtil",["../../lib/jquery","../../util/limit","../../action/contest","../../util/ajax","../../lib/underscore","../../core/base","../../util/util","../../util/cookie","../../core/siteConfig","../../util/dragdrop","../../util/browser","../../component/popup","../../core/component","../../util/event","../../component/layer","../../util/dom","../../util/highlighter","../../lib/syntaxhighlighter/shCore","../../lib/syntaxhighlighter/style/shCoreDefault.css","../../util/shortcut","../../util/littleAction","../../action/note"],function(a,b,c){function d(a){var b=this;b.lastLeft=0,b.isPause=!1,b.dragEl=w("div.full-separator"),b.topicDv=w("div.nowcoder-topic"),b.topicAnswerDv=w("div.nowcoder-topic-answer"),b.questionInfoIpt=w("#jsQuestionInfo"),b.canPauseTime=!!window.canPauseTime,b.initTestPing(),b.initTime(a.timeContainer,a.timeEl,a.isCountingUp),b.initCollect(),b.dragEl.length>0&&b.initDragSplit(),C.init(),b.initShortCut(a.timeContainer),w("div.answer-sheet-box a.card-unfold").on("click",b.toggleFold),w("div.answer-sheet-box a.card-fold").on("click",b.toggleFold),"1"===z.get("showanswersheetbox")&&w("div.answer-sheet-box").addClass("open"),w("div.synchronization").on("click",b.toggleSynchronization),"0"===z.get("nkSynchronization")&&(w("div.synchronization").removeClass("selected"),setTimeout(function(){w("#submitForm input[name=sync]").remove()},1e3)),b.initClickA(),w(document).on("click","ul.answer-sheet-num a",function(a){a.preventDefault();var b=w(a.currentTarget),c=b.attr("data-qid");window.nQFinish=1,w("#submitForm").append('<input type="hidden" name="nqid" value="'+c+'" />').submit()}),E.onlineJudgeHelp({el:w("a.js-click-help")}),b.initCheat(+window.questionInfo.type)}function e(){var a=this,b=window.questionInfo.tid;b&&window.setInterval(function(){a.isPause||x.testPing({body:{testId:b}})},6e4)}function f(a){function b(a){a.preventDefault();var b=w("ul.answer-sheet-num a.answering-num").closest("li"),c=b.next();if(0!==c.length){var d=c.find("a"),e=d.attr("data-qid");window.nQFinish=1,w("#submitForm").append('<input type="hidden" name="nqid" value="'+e+'" />').submit()}}function c(a){a.preventDefault();var b=w("ul.answer-sheet-num a.answering-num").closest("li"),c=b.prev();if(0!==c.length){var d=c.find("a"),e=d.attr("data-qid");window.nQFinish=1,w("#submitForm").append('<input type="hidden" name="nqid" value="'+e+'" />').submit()}}var d=this;d.canPauseTime&&D.add("space",function(){d.isPause||d.toggleTiming(a)}),D.add("up",c),D.add("left",c),D.add("down",b),D.add("right",b)}function g(){var a=this;w("a").on("click",function(b){var c=w(b.currentTarget),d=c.attr("href");return z.isJsHref(d)||"0"===c.attr("data-prevent")?void 0:(b.preventDefault(),window.isLogin?(B.confirm("你本次试卷尚未提交，是否确定离开本页？",function(){window.location.href=d}),void 0):(new B({width:500,title:"提示",hasNoMove:!0,content:['<div class="confirm-content">','<div class="poptip-word">','<span class="warning-ico"></span>','<span class="warning-word">不想继续做题了吗？直接交卷后可以看正确答案哦！</span>',"</div>","</div>"].join(""),okTxt:"提前交卷",cancelTxt:"直接离开",ok:function(){a.submitTest()},cancel:function(){window.location.href=d}}),void 0))})}function h(a,b,c){var d=this,e=+b.data("left")||0,f=+b.data("time")||0,g=c?f:e;d.showTime(b,g,c),d.canPauseTime&&(a=w(a),a.on("click",function(){d.toggleTiming(a)}))}function i(a){var b=this;b.isPause=!b.isPause,a[b.isPause?"addClass":"removeClass"]("time-pause"),a.attr("title",b.isPause?"继续":"暂停");var c=b.questionInfoIpt,d=c.attr("data-tid");return b.isPause?(x.testStop({body:{testId:d}}),new B({width:500,title:"提示",hasNoMove:!0,hasNoTitle:!0,content:['<div class="confirm-content">','<div class="poptip-word">','<span class="warning-ico"></span>','<span class="warning-word">休息一下吧！共 '+(c.attr("data-total")||"")+" 道题，还剩 "+(c.attr("data-left")||"")+" 道没做哦~</span>","</div>","</div>"].join(""),okTxt:"继续做题",cancelTxt:"下次再做",ok:function(){this.close(),b.toggleTiming(a)},cancel:function(){window.location.href="/"}}),void 0):(x.testRestart({body:{testId:d}}),void 0)}function j(a,b,c){var d=this;if(!d.isPause){if(!c&&0>=b)return a.html("答题时间结束"),d.submitTest(),void 0;var e="";if(60>=b)e="00:00:"+d.getNumStr(b);else if(3600>=b)e="00:"+d.getNumStr(Math.floor(b/60))+":"+d.getNumStr(b%60);else if(86400>=b)e=d.getNumStr(Math.floor(b/60/60))+":"+d.getNumStr(Math.floor(b/60%60))+":"+d.getNumStr(Math.floor(b%3600%60));else{var f=Math.floor(b/60/60/24),g=b-86400*f;e=f+"天 "+d.getNumStr(Math.floor(g/60/60))+":"+d.getNumStr(Math.floor(g/60%60))+":"+d.getNumStr(Math.floor(g%3600%60))}a.html(e),a.css("font-size",e.length>8?"18px":"24px"),b=c?b+1:Math.max(0,b-1)}b>=0&&setTimeout(function(){d.showTime(a,b,c)},1e3)}function k(){var a=w(".js-follow");a=0===a.length?w(".js-unfollow"):a,E.follow({followCls:"js-follow",unfollowCls:"js-unfollow",followStr:"收藏本题",entityId:a.attr("data-id"),entityType:y.type.problem})}function l(a){var b=w(a.currentTarget).parent();b.toggleClass("open"),b.hasClass("open")?z.set("showanswersheetbox","1"):z.remove("showanswersheetbox")}function m(a){a.preventDefault();var b=w(a.currentTarget);b.hasClass("selected")?z.set("nkSynchronization","0"):z.remove("nkSynchronization")}function n(a){return 10>a?"0"+a:a+""}function o(a){var b=this,c=w(document.body),d=w("div.nk-container"),e=w("div.nk-main"),f=w("div.nowcoder-topic"),g=w("div.nowcoder-topic-answer");if(a||void 0===a){z.set("questionFullScreen","1"),c.addClass("full-screen-body nk-body"),d.css("backgroundPositionX","35%"),d.css("backgroundPositionY","0"),e.addClass("full-screen-subject"),f.css("width",b.lastLeft?b.lastLeft:"35%"),b.setDragPos(f.width()+10),b.dragEl.show();var h=w(window).height();f.outerHeight(h),g.outerHeight(h),w(window).on("resize",b._winResizeCb=function(){var a=w(window).height();f.outerHeight(a),g.outerHeight(a),b.dragEl.height(a)})}else z.remove("questionFullScreen"),c.removeClass("full-screen-body nk-body"),e.removeAttr("style"),e.removeClass("full-screen-subject"),f.removeAttr("style"),g.removeAttr("style"),b.dragEl.hide(),f.height("auto"),g.height("auto"),b._winResizeCb&&(w(window).unbind("resize",b._winResizeCb),b._winResizeCb=null)}function p(){var a=this,b=a.dragEl;new A({drag:b,listeners:[{name:"start",handler:function(){this.offset=b.offset()}},{name:"drag",handler:function(){var b=this,c=b.offset,d=c.left+b._moveX-b._downX;c.top+b._moveY-b._downY,a.setDragPos(d)}},{name:"drop",handler:function(){this.offset=null}}]})}function q(a){var b=this,c=b.dragEl,d=b.topicDv,e=b.topicAnswerDv,f=w(window).width();300>a&&(a=300),450>f-a&&(a=f-450),b.lastLeft=a;var g=100*a/f;c.css("marginLeft",g+"%"),c.css("height",w(window).height()),d.css("width",g-.8+"%"),e.css("marginLeft",g+"%"),e.css("width",100-g-2.8+"%")}function r(a){var b=this,c=window.questionInfo.tid,d=!!window.isContest;if(d){var e=+window.leaveCount||0;b.forbidRightMenu(),b.forbidSelect();var f=y.questionType;(a===f.danxuan||a===f.duoxuan||a===f.tiankong)&&(e>3&&(b.cheatAlerting=!0,B.alert("很遗憾，你离开当前考试页面的次数已经超过 3 次，系统将为你强制交卷，并记录违规行为。",function(){b.cheatAlerting=!1,b.submitTest()})),b.forbidBurWindow(function(){b.cheatAlerting||(x.addLeave({body:{testId:c}}),e++,e>3?(b.cheatAlerting=!0,B.alert("很遗憾，你离开当前考试页面的次数已经超过 3 次，系统将为你强制交卷，并记录违规行为。",function(){b.cheatAlerting=!1,b.submitTest()})):(b.cheatAlerting=!0,B.alert("你已离开当前页面 "+e+" 次，客观题部分离开超过 3 次将无法继续考试。",function(){b.cheatAlerting=!1})))}))}}function s(){w(document).on("contextmenu",function(){return!1}).on("click",function(a){3===a.witch&&a.preventDefault()})}function t(){w(document).on("selectstart",function(){return!1}),w(document.body).css("-moz-user-select","none")}function u(a){var b=null,c=!0,d=F.ie();w(window).blur(function(){return d&&8>=d&&c?(c=!1,void 0):(b&&window.clearTimeout(b),b=window.setTimeout(function(){a&&a()},100),void 0)}),w(window).focus(function(){b&&(window.clearTimeout(b),b=null)})}function v(){window.nQFinish=1,w("#submitForm").append('<input type="hidden" name="finish" value="1" />').submit()}var w=a("../../lib/jquery");a("../../util/limit");var x=a("../../action/contest"),y=a("../../core/siteConfig"),z=a("../../util/util"),A=a("../../util/dragdrop"),B=a("../../component/popup");a("../../util/dom");var C=a("../../util/highlighter"),D=a("../../util/shortcut"),E=a("../../util/littleAction"),F=a("../../util/browser");c.exports={init:d,initTime:h,initCollect:k,initClickA:g,initTestPing:e,initShortCut:f,toggleTiming:i,showTime:j,toggleFold:l,toggleSynchronization:m,getNumStr:n,gotoFullScreen:o,initDragSplit:p,setDragPos:q,initCheat:r,forbidRightMenu:s,forbidSelect:t,forbidBurWindow:u,submitTest:v}});
