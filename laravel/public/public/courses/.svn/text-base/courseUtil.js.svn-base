define("nowcoder/1.2.348/javascripts/site/courses/courseUtil",["../../lib/jquery","../../lib/underscore","../../core/base","../../util/limit","../../component/popup","../../core/component","../../util/util","../../util/cookie","../../util/event","../../component/layer","../../util/dragdrop","../../util/browser","../../util/highlighter","../../lib/syntaxhighlighter/shCore","../../lib/syntaxhighlighter/style/shCoreDefault.css","../../action/courses","../../util/ajax","../../core/siteConfig"],function(a,b,c){function d(a){var b=this;b.isLogin=!!(window.globalInfo||{}).ownerId,b.section=a,o(document).on("click",".nc-req-buy",function(a){a.preventDefault();var c=o(a.currentTarget);(!c.hasClass("nc-req-auth")||b.isLogin)&&b.popupBuy()}),o(document).on("click",".js-click-go-next",function(a){b.goNextPart(a)})}function e(a){var b=this,c={vCmdPlay:"j2s_resumeVideo",vCmdPause:"j2s_pauseVideo",vCmdJump:"j2s_seekVideo",vCmdStop:"j2s_stopVideo",vCmdChange:"changeVid",vCmdDuration:"j2s_getDuration",vCmdCurrentTime:"j2s_getCurrentTime",vCmdFlowCount:"j2s_getFlowCount",vCmdWatchTime:"j2s_stayInVideoTime"};p.forEach(c,function(c,d){a[d]=function(){var a=b.getPlayer();try{a&&a[c].apply(a,arguments)}catch(d){}}}),a.vCmdReplay=function(){var a=this;a.vCmdPlay()}}function f(a){var b={vEventInitOver:"s2j_onPlayerInitOver",vEventPlayStart:"s2j_onPlayStart",vEventPlayOver:"s2j_onPlayOver",vEventPlay:"s2j_onVideoPlay",vEventPause:"s2j_onVideoPause",vEventSeek:"s2j_onVideoSeek",vEventPptDataParam:"s2j_onPptDataParam",vEventInteractionData:"s2j_onInteractionData"};p.forEach(b,function(b,c){a[c]&&(window[b]=function(){a[c].apply(a,arguments)})})}function g(){var a=this,b=a.objectEl.attr("id");if(-1!=window.navigator.appName.indexOf("Microsoft")){var c=window[b];return c.length>0?c[0]:c}return document[b]}function h(a){function b(a,b){var c=this,d=Math.floor((a-1)/m);c.go2page(d,b)}function c(a,b){a=0>a?0:a>=p?p-1:a,k=a,b?g.css({marginLeft:-1*t*a}):g.animate({marginLeft:-1*t*a},250)}function d(){var a=this;a.go2page(k+1)}function e(){var a=this;a.go2page(k-1)}var f=o(a.el),g=f.find("ul.course-progress-bar"),h=g.children(),i=f.find("a.course-pre"),j=f.find("a.course-next"),k=+a.currentPos||0,l=h.length,m=a.countInLine,n=m,p=Math.floor((l-1)/m)+1,q=o(h[0]),s=q.width()+window.parseInt(q.css("marginRight"),10),t=s*n,u={go2index:b,go2page:c,goNext:d,goPre:e};return k=0>=k?0:k,u.go2index(k,!0),i.on("click",function(a){a.preventDefault();var b=o(a.currentTarget);!r.mark(b)&&u.goPre(),r.pause(b)}),j.on("click",function(a){a.preventDefault();var b=o(a.currentTarget);!r.mark(b)&&u.goNext(),r.pause(b)}),h.on("click",function(b){a.click&&a.click.call(u,b)}),u}function i(a){var b=this,c=b.section,d="",e="",f=!!c.hasNextSection,g=!c.nextFree&&!c.purchased,h=c.nextRequireLogin&&!b.isLogin;if(f)if(g)d='<div><span class="pop-c-tip">下节内容需付费，是否报名参加全部课程？</span></div>',e=["<div>",'<a href="/order?itemId='+c.courseId+'&itemType=COURSE" class="btn btn-primary confirm-btn">购买课程</a>',"</div>"].join("");else{var i=h?"javascript:void(0);":c.nextUrl,j=h?" nc-req-auth ":"";e='<a href="'+i+'" class="btn btn-primary confirm-btn '+j+'">进入'+c.nextName+"</a>",c.sectionPos===c.sectionCount&&(e+='<a class="btn btn-primary confirm-btn" href="'+c.courseUrl+'">返回课程主页</a>')}else d='<div><span class="pop-c-tip">本章节已全部完成</span></div>',e='<a class="btn btn-primary confirm-btn" href="'+c.courseUrl+'">返回课程主页</a>';return a=a||0,new s({title:"恭喜通过本题",width:510,hasNoFooter:!0,content:['<div class="pop-course">','<div class="pop-c-main">','<img src="http://uploadfiles.nowcoder.com/images/20150917/56_1442473597080_5C130CBAC545EFC73DB906618F09B256">','<span class="pop-c-tip">你获得的成就值 <span class="font-red">+',a,"</span></span>",d,"</div>",e,"</div>"].join(""),ok:function(){}})}function j(){var a=this,b=a.section,c=b.nextUrl,d=['<div class="pop-c-main">','<img src="http://uploadfiles.nowcoder.com/images/20150917/56_1442474150525_5C130CBAC545EFC73DB906618F09B256">','<span class="pop-c-tip">你获得的牛币 <span class="font-red">+',b.coin||0,"</span></span>","</div>"].join("");return d=b.coin?d:"",new s({title:"本章节已全部完成",width:510,hasNoFooter:!0,content:['<div class="pop-course">',d,'<a href="',c,'" class="btn btn-primary confirm-btn">进入下一章</a>','<a href="',b.courseUrl,'" class="btn btn-primary confirm-btn">返回课程主页</a>',"</div>"].join(""),ok:function(){}})}function k(){var a=this,b=a.section;return new s({title:"提示",width:510,hasNoFooter:!0,content:['<div class="pop-course">','<div class="pop-c-main"><span class="pop-c-tip">本节内容需付费，是否购买本门课程？</span></div>','<a href="/order?itemId='+b.courseId+'&itemType=COURSE" class="btn btn-primary confirm-btn">购买课程</a>',"</div>"].join(""),ok:function(){a.popupPayStatus(b.uuid)}})}function l(a){var b="";if(a.length>0){var b='<div class="result-avatar-box"><ul class="result-avatar-list">';p.forEach(a,function(a,c){b+=q.execTpl(['<li class="',0===c?"correct-person-checked":"",'">','<div class="head-pic-bg">','<a href="/profile/#{id}" class="head-pic" target="_blank"><img src="#{avatar}"></a>',"</div>",'<a href="/profile/#{id}" title="#{name}" class="correct-person-name level-color-#{level}"  target="_blank">#{name}</a>','<a href="javascript:void(0);" class="btn btn-large btn-primary correct-person-btn" id="">查看代码</a>',"</li>"].join(""),{id:a.id,name:a.name,avatar:a.headUrl,level:a.honorLevel})}),b+="</ul></div>",b+='<div class="js-code-container"><pre class="prettyprint">'+t.encodeHTML(a[0].code)+"</pre></div>"}else b=['<div id="commentNone" class="blank-box">','<div class="blank-img"><img src="http://static.nowcoder.com/images/sofa.png"></div>',"<p>虚位以待</p>","</div>"].join("");return new s({title:"做对这道题的人",width:958,content:b,listeners:{render:function(){a.length>0&&u.init()},"click ul.result-avatar-list li":{handler:function(b){var c=this.getEl(),d=o(b.currentTarget),e=d.index();c.find(".js-code-container").html('<pre class="prettyprint">'+t.encodeHTML(a[e].code)+"</pre>"),c.find("ul.result-avatar-list li").removeClass("correct-person-checked"),d.addClass("correct-person-checked"),u.init()}}}})}function m(a){new s({cls:"payment-pop-box",hasNoFooter:!0,title:"购买课程",content:['<div class="payment-confirm">','<a href="javascript:void(0);" class="btn btn-primary confirm-btn">购买成功</a>','<a href="javascript:void(0);" class="btn btn-default cancle-btn">遇到问题</a>',"</div>"].join(""),ok:function(){window.location.reload()},cancel:function(){window.location.reload()}});var b=!1;window.setTimeout(function(){var c=arguments.callee;v.checkStatus({query:{orderId:a},call:function(a){a.data&&s.tips("购买成功",function(){window.location.reload()})},always:function(){!b&&window.setTimeout(c,800)}})},800)}function n(a){var b=this,c=b.section,d=o(a.currentTarget);d.hasClass("nc-req-auth")||d.hasClass("nc-req-buy")||c.sectionPos===c.sectionCount&&c.hasNextSection&&(a.preventDefault(),b.popupChapter())}var o=a("../../lib/jquery"),p=a("../../lib/underscore"),q=a("../../core/base"),r=a("../../util/limit"),s=a("../../component/popup"),t=a("../../util/util");a("../../util/event");var u=a("../../util/highlighter"),v=a("../../action/courses");c.exports={initialize:d,initPlayerCmd:e,initPlayerEvent:f,getPlayer:g,initProgressBar:h,popupQuestion:i,popupChapter:j,popupBuy:k,popupCodeUser:l,popupPayStatus:m,goNextPart:n}});
