define("nowcoder/1.2.348/javascripts/site/courses/detailExam",["../../lib/jquery","../../lib/underscore","../../core/base","./courseUtil","../../util/limit","../../component/popup","../../core/component","../../util/util","../../util/cookie","../../util/event","../../component/layer","../../util/dragdrop","../../util/browser","../../util/highlighter","../../lib/syntaxhighlighter/shCore","../../lib/syntaxhighlighter/style/shCoreDefault.css","../../action/courses","../../util/ajax","../../core/siteConfig","../../util/littleAction","../../util/dom","../../action/contest","../../action/note","../../component/codeEditor","../../../stylesheets/codemirror/codemirror.css","../../../stylesheets/codemirror/theme/monokai.css","../../lib/codemirror/codemirror","../../lib/codemirror/mode/clike/clike","../../lib/codemirror/addon/edit/matchbrackets","../../lib/codemirror/addon/edit/closebrackets","../../component/select","../../action/code","../../component/checkgroup","../../component/checkbox"],function(a){function b(){var a=this;p.copy(a,window,["problem","video","section"]),a.rightAnswerEl=n("#jsRightAnswerContainer"),a.resultEl=n("#jsResultContainer"),a.optionEl=n("#jsOptionContainer"),a.isRadio=a.problem.type===r.questionType.danxuan,a.isCheckBox=a.problem.type===r.questionType.duoxuan,a.progressBar=q.initProgressBar({el:n("div.course-progress-wrap"),countInLine:10,currentPos:a.section.sectionPos}),q.initialize(a.section),q.initPlayerCmd(a),q.initPlayerEvent(a),s.follow({followCls:"js-follow",unfollowCls:"js-unfollow",entityId:a.problem.id,entityType:r.type.problem}),s.correction({el:n(".js-correction"),entityId:a.problem.id,entityType:r.type.problem});var b=s.initCodeEditor(u,{questionId:a.problem.id,codeJudgeType:window.codeJudgeType,cTpl:n("#cTpl"),javaTpl:n("#javaTpl"),pythonTpl:n("#pythonTpl"),cSharpTpl:n("#cSharpTpl"),codeEl:n("#jsCodeEditor"),runInfoEl:n("#jsRunInfo"),runCodeEl:n("#jsRunCode"),autoFixHeight:!1});b.listen("runCodeSuccess",function(){a.isFirstExam()&&(q.popupQuestion(3),a.removeFirstExam())}),a.initRadio(),a.initCheckbox(),y.init()}function c(){var a=this;a.isRadio&&(a.checkgroup=v.mix({el:n("a.subject-options label"),change:function(a){n("a.subject-options").removeClass("selected");var b=a.getEl();b.parent().addClass("selected")}}),o.each(a.checkgroup.option,function(a){var b=a.getEl().parent();b.on("click",function(b){b.stopPropagation(),b.preventDefault(),a.fire("click")})}))}function d(){var a=this;a.isCheckBox&&(a.checkgroup=v.mix({el:n("a.subject-options label"),change:function(a){var b=a.getEl();b.parent()[a.isChecked()?"addClass":"removeClass"]("selected")}}),o.each(a.checkgroup.option,function(a){var b=a.getEl().parent();b.on("click",function(b){b.stopPropagation(),b.preventDefault(),a.fire("click")})}))}function e(a){var b=this;if(b.isRadio||b.isCheckBox){a=a||"";var c=b.isChoiseRight(a),d=[],e=[],f="";o.forEach(b.problem.answers,function(g,h){var i=a&&-1!=a.indexOf(g.id+""),j=g.right;i&&d.push(A.charAt(h)),j&&e.push(A.charAt(h));var k=j?"green-answer-item":!j&&i?"orange-answer-item":"";b.isCheckBox&&(k=j?"green-answer-item":"",c||(k=j?i?"two-color-border":"green-answer-item":i?"orange-answer-item":"")),f+='<div class="result-answer-item '+k+'"><pre>'+g.content+"</pre></div>"}),f="<h1>正确答案: "+e.join("&nbsp;")+"&nbsp;&nbsp;你的答案: "+d.join("&nbsp;")+'<span class="'+(c?"font-green":"font-orange")+'">('+(c?"正确":"错误")+")</span></h1>"+f,b.optionEl.hide(),b.resultEl.html(f).show()}}function f(a){a.preventDefault();var b=this,c=n(a.currentTarget);if("none"===b.optionEl.css("display"))return b.optionEl.show(),b.resultEl.hide(),o.forEach(b.checkgroup.option,function(a){a.checked(!1),a.getEl().closest("a.subject-options").removeClass("selected")}),c.html("提交"),void 0;var d=b.checkgroup.val();if(void 0===d)return w.alert("请选择答案");if(b.isFirstExam()){if(x.mark(c))return;t.judgeQuestion({body:{qid:b.problem.id,content:d},call:function(){b.isChoiseRight(d)&&b.removeFirstExam(),b.renderAnswerResult(d),c.html("再做一次")},error:function(a){w.alert(a.msg)},always:function(){x.clear(c)}})}else t.judgeQuestion({body:{qid:b.problem.id,content:d}}),b.renderAnswerResult(d),c.html("再做一次")}function g(){var a=this,b=a.rightAnswerEl,c=b.find("div.design-answer-box");if(a.isRadio||a.isCheckBox){var d=[];o.forEach(a.problem.answers,function(a,b){a.right&&d.push(A.charAt(b))}),c.html(0===d.length?"暂无参考答案":d.join("&nbsp;"))}else{var e=n("#jsReferCode").val(),f=!!n.trim(e);e=f?z.encodeHTML(e):"暂无参考答案",c.html(f?'<pre class="prettyprint">'+e+"</pre>":e),f&&y.init()}b.slideDown(120)}function h(a){var b=this,c=n(a.currentTarget);return a.preventDefault(),b.doneRightCache&&b.doneRightCache.length>0?q.popupCodeUser(b.doneRightCache):(x.mark(c)||t.codeDoneRight({query:{qid:b.problem.id},call:function(a){q.popupCodeUser(a.data),b.doneRightCache=a.data},error:function(a){w.alert(a.msg)},always:function(){x.clear(c)}}),void 0)}function i(){var a=this,b=918,c=416,d=a.video.videoId,e=new w({title:"回顾知识点",hasNoFooter:!0,content:'<div style="font-size:14px;text-align:center;">视频加载中...</div>',width:b+40,listeners:{render:function(){t.getVideoCode({body:{sectionId:a.video.videoSectionId},call:function(f){var g=e.popupContent;g.html(['<div style="background:#000;position:relative;height:',c,'px;">','<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="',b,'" height="',c,'" id="',d,'">','<param name=movie value="http://player.polyv.net/videos/player.swf">','<param name="allowscriptaccess" value="always">','<param name="wmode" value="Transparent">','<param name="flashvars" value="vid=',d,"&start=",+a.video.videoProgress||0,'"/>','<param name="allowFullScreen" value="true"/>','<embed src="http://player.polyv.net/videos/player.swf" width="',b,'" height="',c,'"','TYPE="application/x-shockwave-flash" allowscriptaccess="always"','wmode="Transparent" name="',d,'"','allowFullScreen="true"','flashvars="vid=',d,"&start=",+a.video.videoProgress||0,"&code="+f.data.code+'"/>',"</embed>","</object>","</div>"].join("")),e.fixPosition()},error:function(a){e.close(),w.alert(a.msg)}})}}})}function j(){var a=this;t.doneVideo({body:{chapterId:a.section.chapterId,sectionId:a.section.id}})}function k(){var a=this,b=+a.section.id;if(!b)return!1;var c=a.section.notFinishSections||[];return o.contains(c,b)}function l(){var a=this,b=+a.section.id,c=a.section.notFinishSections||[];a.section.notFinishSections=o.without(c,b)}function m(a){var b=this;if(!b.isRadio&&!b.isCheckBox)return!1;a=a||"";var c=o.filter(b.problem.answers,function(a){return a.right}).map(function(a){return a.id+""}),d=o.compact(a.split(",")),e=d.length===c.length&&o.uniq(d.concat(c)).length===c.length;return e}var n=a("../../lib/jquery"),o=a("../../lib/underscore"),p=a("../../core/base"),q=a("./courseUtil"),r=a("../../core/siteConfig"),s=a("../../util/littleAction"),t=a("../../action/courses"),u=a("../../component/codeEditor"),v=a("../../component/checkgroup"),w=a("../../component/popup"),x=a("../../util/limit"),y=a("../../util/highlighter"),z=a("../../util/util"),A="ABCDEFGHIJKLMNOPQRSTUVWXYZ";p.ready({initialize:b,binds:{"click #jsLookBack":i,"click #jsSubmit":f,"click #jsWacthReference":g,"click #jsWatchPass":h},initRadio:c,initCheckbox:d,renderAnswerResult:e,vEventPlayOver:j,isFirstExam:k,removeFirstExam:l,isChoiseRight:m})});
