define("nowcoder/1.2.348/javascripts/site/contest/questionInPublic",["../../lib/jquery","../../lib/underscore","../../core/base","../../util/util","../../util/cookie","../../util/limit","../../core/siteConfig","../../component/subComment","../../core/component","../../util/event","../../util/dom","../../util/browser","../../action/contest","../../util/ajax","../../component/popup","../../component/layer","../../util/dragdrop","../../util/ke","../../lib/kindeditor","../../component/menu","../../component/select","../../component/popupCommon","../../action/code","../../action/question","../../util/highlighter","../../lib/syntaxhighlighter/shCore","../../lib/syntaxhighlighter/style/shCoreDefault.css","../../component/popupCaptcha","../../util/littleAction","../../action/note"],function(a){function b(){var a=this;a.canKeepTop=(!V.ie()||V.ie()>=9)&&document.elementFromPoint,d.call(a),a.codeJudgeType=window.codeJudgeType,a.focusDiscuss(),K.copy(a,window,["problem","comment"]),a.comment.draft=(a.comment.draft||{}).content||"",a.globalInfo=J.clone(window.globalInfo),a.cmtMap={},a.cmtItemMap={},a.initEditor(),a.followCountEl=I("div.q-info-tip span.follow-count"),a.commentCountEl=I("div.q-info-tip span.comment-count"),a.cmtListUl=I("#commentList"),a.cmtTipsDv=I("#commentTips"),a.cmtNoneDv=I("#commentNone"),a.loadMoreEl=a.cmtListUl.parent().find("a.btn-block"),a.codeEditorEl=I("div#codeEditor"),a.subjectMainEl=I("#subjectMain"),a.javaTextarea=I("#javaTpl"),a.cppTextarea=I("#cTpl"),a.pythonTextarea=I("#pythonTpl"),a.cSharpTextarea=I("#cSharpTpl"),a.renderCmt(),a.initUpload(),X.init(),Z.follow({followCls:"click-follow",unfollowCls:"click-unfollow",entityId:a.problem.id,entityType:N.type.problem}),Z.correction({el:I("a.click-correction"),entityId:a.problem.id,entityType:N.type.problem}),Z.note({container:I("div.js-my-notes"),editCls:["js-click-note"],delCls:["js-del-note"],foldCls:["show-all-notes","fold-notes"],entityId:a.problem.id,entityType:N.type.problem,noteId:a.problem.noteId,ok:function(){window.location.reload()}}),Z.onlineJudgeHelp({el:I("a.oprt-help")})}function c(){var a=L.getParam("toCommentId")||"";if(a=a.split("?")[0]){var b=I("div.js-discussion"),c=I(b.find("li.answer-list-item")[0]);c.find("[data-cmt-id="+a+"]").length>0&&(W.scrollToEl({el:b,animation:!1,ext:-I("div.nowcoder-header").height()-10}),W.highLight({el:c}))}else if("discussion"===L.getParam("f")){var b=I("div.js-discussion");W.scrollToEl({el:b,animation:!1}),W.highLight({el:b})}}function d(){var a=this;if(a.canKeepTop){a.navVal||(a.navVal={x:I(window).width()/2,y:_});var b=a.navVal,c=I(document.elementFromPoint(b.x,b.y)),d=I(document.elementFromPoint(b.x,b.y+120)),e=I(c.closest("li.answer-list-item")),f=I(d.closest("li.answer-list-item")),g=a.currentLi;return f.get(0)!==e.get(0)?(g&&g.find("div.votebar").removeClass("keep-top"),a.currentLi=null,void 0):(e.get(0)&&g&&g.get(0)===e.get(0)||(g&&g.find("div.votebar").removeClass("keep-top"),a.currentLi=null,e.get(0)&&(e.find("div.votebar").addClass("keep-top"),this.currentLi=e)),void 0)}}function e(){var b=this;if(I("div.js-editor").length>0){var c=function(){window.isLogin||(b.commentIpt.blur(),a.async("../../component/loginDialog",function(a){a.show({register:N.popup.showReg,loginCb:function(){window.location.reload()},registerCb:function(){window.location.reload()}})}))};b.commentIpt=P.create("div.js-editor",{toolbarFixedTop:W.getNavHeight(),placeholder:"请输入正确的答案及解题思路",disabled:!window.isLogin,afterFocus:c,clickMask:c,draftChange:function(a){window.isLogin&&S.saveAnswerDraft({body:{entityId:b.problem.id,content:a}})},height:180}),b.comment.draft&&b.commentIpt.html(b.comment.draft)}}function f(){var b=this;a.async("../../component/codeEditor",function(a){var c={questionId:b.problem.id},d=a.getCacheCode(c)||{},e=d.code,f=d.language||N.language.cpp+"",g=b.codeJudgeType,h="0"===g||"1"===g&&b.pythonTextarea.length>0,i="0"===g||"1"===g&&b.cSharpTextarea.length>0,j=[{value:N.language.cpp,checked:f===N.language.cpp,code:e&&f===N.language.cpp?e:I.trim(b.cppTextarea.val())},{value:N.language.java,checked:f===N.language.java,code:e&&f===N.language.java?e:I.trim(b.javaTextarea.val())}];h&&j.push({value:N.language.python,checked:f===N.language.python,code:e&&f===N.language.python?e:I.trim(b.pythonTextarea.val())}),i&&j.push({value:N.language.csharp,checked:f===N.language.csharp,code:e&&f===N.language.csharp?e:I.trim(b.cSharpTextarea.val())}),b.codeEditor=new a({renderTo:b.subjectMainEl,options:j,runCode:c,cacheCode:!0,tipEl:I("#subjectInfo")})})}function g(){var b=this;a.async("../../component/codeEditorFE",function(a){b.codeEditor=new a({renderTo:b.subjectMainEl,supportLang:window.supportLang,languages:[{text:"html",code:I.trim(I("#htmlTpl").val())},{text:"css",code:I.trim(I("#cssTpl").val())},{text:"javascript",code:I.trim(I("#javascriptTpl").val()),checked:!0}],runCode:{questionId:b.problem.id},tipEl:I("#subjectInfo")})})}function h(){var a=this,b=a.comment.all,c=a.comment.count;0===c?(a.cmtListUl.hide(),a.cmtNoneDv.show()):(a.cmtListUl.show(),a.cmtNoneDv.hide()),a.loadMoreEl[b.length===c?"hide":"show"]();var d;if(J.each(b,function(b){a.cmtMap[b.id]=b,b.isRecommend&&(d=!0,a.comment.first=b)}),d&&(a.firstCommentEl=a.cmtListUl.find("li.js-first-comment")),!a.firstCommentRendered){a.firstCommentRendered=!0;var e=I(a.cmtListUl.find("div.answer-content")[0]);u.call(a,{currentTarget:e.find("a.click-reply"),firstCount:3})}X.init()}function i(a){var b=this,c=b.problem.isAdmin;if(0===a.length)b.loadMoreEl.hide();else{var d,e,f="",g=a.length;J.each(a,function(a,h){d=a.toComment&&g>h+1,a.isRecommend?(e=!0,b.comment.first=a,a.isComplete||(a.content+='&nbsp;&nbsp;<a href="javascript:void(0)" class="show-ref-answer kind-link nc-req-auth">查看全部</a>'),f+='<li class="answer-list-item clearfix js-first-comment"'+(d?' style="border:none;"':"")+'><div class="recommend-tag"></div>'+b.getCmtStr(a,!0,!0,c)+"</li>"):f+=d?'<li class="answer-list-item clearfix"'+(d?' style="border:none;"':"")+">"+b.getCmtStr(a,!0)+"</li>":b.getCmtStr(a),d&&(f+='<li class="more-answer">更多回答</li>')}),b.cmtListUl.append(f),e&&(b.firstCommentEl=b.cmtListUl.find("li.js-first-comment"))}}function j(a,b,c){var d=this;d.cmtMap[a.id]=a;var e=[b?"":'<li class="answer-list-item clearfix">','<div class="votebar">','<button class="#{likeClass}" aria-pressed="false" title="#{likeNameNew}"><i class="vote-arrow"></i><span class="count">#{likes}</span></button>','<button class="#{dislikeClass}" aria-pressed="true" title="#{dislikeNameNew}"><i class="vote-arrow"></i></button>',"</div>",'<div class="answer-content clearfix" data-cmt-id="#{id}" data-dislikecnt="#{dislikes}" data-isdisliked="#{dislikeName}"',c?'data-recommend="1" ':"",">",'<a href="/profile/#{authorId}" class="answer-head"><img src="#{avatar}" alt="#{authorName}头像"></a>','<div class="answer-detail" data-cmt-id="#{id}">','<p><a class="answer-name" href="/profile/#{authorId}" title="#{authorName}">#{authorName}</a></p>','<div class="answer-brief">#{content}</div>','<div class="answer-legend">',a.edited?'<span class="answer-time">编辑于 #{updateTime}</span>':'<span class="answer-time">发表于 #{createTime}</span>','<a class="click-reply" href="javascript:void(0);">回复(#{commentCnt})</a>',!c&&d.problem.isAdmin?'<a class="click-set-referanswer" href="javascript:void(0);">设为参考答案</a>':"",c&&d.problem.isAdmin?'<a class="click-unset-referanswer" href="javascript:void(0);">取消设为参考答案</a>':"",a.authorId==d.globalInfo.ownerId||d.problem.isAdmin?'<a class="click-edit" href="javascript:void(0);">修改</a><a class="click-del" href="javascript:void(0);">删除</a>':"","</div>","</div>","</div>",b?"":"</li>"].join(""),f=new Date(a.createTime),g=new Date,h=f.getFullYear()===g.getFullYear()&&f.getMonth()===g.getMonth()&&f.getDate()===g.getDate(),i=new Date(a.updateTime),j=i.getFullYear()===g.getFullYear()&&i.getMonth()===g.getMonth()&&i.getDate()===g.getDate();return K.execTpl(e,{id:a.id,authorId:a.authorId,avatar:a.headImg||N.avatar.small,authorName:a.authorName,content:a.content,createTime:h?"今天 "+L.formDate(f,"HH:mm:ss"):L.formDate(f,"yyyy-MM-dd HH:mm:ss"),updateTime:j?"今天 "+L.formDate(i,"HH:mm:ss"):L.formDate(i,"yyyy-MM-dd HH:mm:ss"),commentCnt:a.commentCnt||0,likeName:a.isLiked?"已赞":"赞",likes:a.likes||0,dislikeName:a.isDisLiked?"已踩":"踩",dislikes:a.dislikes||0,likeClass:a.isLiked?"click-like up pressed":"click-like up",dislikeClass:a.isDisLiked?"click-dislike down pressed":"click-dislike down",likeNameNew:a.isLiked?"取消赞同":"赞同",dislikeNameNew:a.isDisLiked?"取消反对":"反对"})}function k(){var a=this,b=a.comment.all;S.getComment({urlParam:{pageSize:a.comment.pageSize,preCommentId:b[b.length-1].id,order:a.comment.sort,entityId:a.problem.id,entityType:N.type.problem,excludeCommentId:a.comment.toCommentId},call:function(c){var d=c.comments;a.comment.all=b.concat(d),a.renderCmtList(d),a.comment.count<=a.comment.all.length&&a.loadMoreEl.hide(),X.init()},error:function(a){Q.alert(a.msg||N.tips.ajaxError)}})}function l(){function a(){var a=I.trim(b.commentIpt.html());S.comment({body:{entityType:N.type.problem,entityId:b.problem.id,commentContent:a,toUserId:0,toCommentId:0},call:function(c){Q.show({noUnique:!0,content:"你的答案已提交",duration:1500,type:"ok",close:function(){W.scrollToEl({el:I("div.js-discussion"),ext:I("div.email-validate").length>0?-91:-60,animation:!0})}}),b.commentIpt.html(""),b.comment.count++,b.commentCountEl.html(b.comment.count+"条讨论");var d={id:c.commentId,headImg:b.globalInfo.ownerTinyHead,authorId:b.globalInfo.ownerId,authorName:b.globalInfo.ownerName,content:a,createTime:(new Date).getTime(),commentCnt:0,isLiked:!1,likes:0,isAdmin:b.problem.id};b.comment.all.push(d),b.cmtMap[c.commentId]=d,b.cmtTipsDv.hide(),b.cmtNoneDv.hide(),b.firstCommentEl?b.firstCommentEl.after(b.getCmtStr(d)):b.cmtListUl.prepend(b.getCmtStr(d)).show(),X.init();var e=I(b.commentIpt.edit.div).closest("div.module-body");b.commentIpt.remove();var f=window.location.href.replace(window.location.search||"","");f=L.addParam({toCommentId:c.commentId},f),e.replaceWith('<div class="module-body answered-tip-white">这道题你已经答过了，可以对<a href="'+f+'">现有的回答</a>进行修改</div>'),I("#jsDealAnswer").html('<i class="ico-submit"></i>修改回答').attr("href",f)},error:function(a){Q.alert(a.msg||N.tips.ajaxError)}})}var b=this,c=b.problem.type,d=I.trim(b.commentIpt.text());return d?(1!==c&&2!==c||!/^([a-z]|[A-Z]|[0-9]|\s|[,，、])+$/.test(d)?a():Q.confirm("除了答案外，还需要写清楚解题思路哦~~只写答案可能会被管理员删除的，确定现在提交吗",function(){a()}),void 0):(Q.alert("内容不能为空"),void 0)}function m(a){var b=this;I(a.currentTarget).blur(),b.codeEditor.runCode()}function n(a){a.preventDefault();var b=this,c=b.problem.uuid;c&&R.wx("http://www.nowcoder.com/qr/question/"+c)}function o(a){var b=this;if(window.isLogin){var c=I(a.currentTarget),d=c.attr("data-type");if(("asked"===d||"asking"===d)&&!M.mark(c)){var e="asked"===d;S[e?"cancelWantAnswer":"wantAnswer"]({body:{id:b.problem.id},call:function(){var a=+c.attr("data-count")||0;a+=e?-1:1,c.attr("data-count",a),c.html((e?"求解答":"已求解答")+"("+a+")"),c.attr("data-type",e?"asking":"asked")},error:function(a){Q.alert(a.msg)},always:function(){M.pause(c)}})}}}function p(a){var b=this,c=I(a.currentTarget),d=c.parents("div.answer-content");!!d.attr("data-recommend");var e=d.attr("data-cmt-id"),f=b.cmtMap[e];if(d&&e&&f&&!M.mark(c)){var g=f.isLiked;S[g?"unlike":"like"]({body:{id:e,type:N.type.comment},call:function(a){f.isLiked=!g,f.likes=a.count,c.html((g?"赞":"已赞")+"("+f.likes+")")},error:function(a){Q.alert(a.msg||N.tips.ajaxError)},always:function(){M.pause(c)}})}}function q(a){var b=this,c=I(a.currentTarget),d=c.closest("li.answer-list-item").find("div.answer-content");!!d.attr("data-recommend");var e=d.attr("data-cmt-id"),f=b.cmtMap[e];if(d&&e&&f&&!M.mark(c)){var g=f.isLiked;S[g?"unlike":"like"]({body:{id:e,type:N.type.comment,likeType:0},call:function(a){f.isLiked=!g,f.likes=a.count,f.isLiked&&f.isDisLiked&&(f.isDisLiked=!1);var b=c.children("span.count"),d=c.siblings(".down");f.isLiked?(c.addClass("pressed").attr("title","取消赞同"),d.removeClass("pressed").attr("title","反对")):(c.removeClass("pressed"),c.attr("title","取消反对")),b.text(f.likes+"")},error:function(a){Q.alert(a.msg||N.tips.ajaxError)},always:function(){M.pause(c)}})}}function r(a){var b=this,c=I(a.currentTarget),d=c.closest("li.answer-list-item").find("div.answer-content");!!d.attr("data-recommend");var e=d.attr("data-cmt-id"),f=b.cmtMap[e];if(d&&e&&f&&!M.mark(c)){var g=f.isDisLiked;S[g?"unlike":"like"]({body:{id:e,type:N.type.comment,likeType:1},call:function(){f.isDisLiked=!g,f.isDisLiked&&f.isLiked&&(f.isLiked=!1,f.likes--);var a=c.siblings(".up");f.isDisLiked?(c.addClass("pressed"),c.attr("title","取消反对"),a.removeClass("pressed"),a.attr("title","赞同")):(c.removeClass("pressed"),c.attr("title","反对")),a.find("span.count").html(f.likes)},error:function(a){Q.alert(a.msg||N.tips.ajaxError)},always:function(){M.pause(c)}})}}function s(b){var c=I(b.currentTarget),d=c.attr("src");b.stopPropagation(),b.preventDefault(),d&&a.async("../../component/popupImage",function(a){new a({items:[d]})})}function t(a){var b=this,c=I(a.currentTarget),d=c.parents("div.answer-content"),e=d.attr("data-cmt-id"),f=b.cmtMap[e];d&&e&&f&&!M.mark(c)&&Q.confirm("确定删除评论？",function(){S.delComment({body:{id:e},call:function(){Q.tips("操作成功",function(){window.location.reload()})},error:function(a){Q.alert(a.msg||N.tips.ajaxError)},always:function(){M.pause(c)}})},function(){M.clear(c)})}function u(a){var b=this,c=I(a.currentTarget),d=c.closest("div.answer-content"),e=d.attr("data-cmt-id"),f=b.cmtMap[e],g=!!d.attr("data-recommend");if(d&&e&&f&&!M.mark(c)){var h=b.cmtItemMap,i=d.find("div.answer-detail");h[e]||(h[e]={item:new O({renderTo:i,comment:f,recommend:g,listeners:{addCmt:function(){f.commentCnt++,c.html("回复("+f.commentCnt+")")},delCmt:function(){f.commentCnt--,c.html("回复("+f.commentCnt+")")}},firstCount:a.firstCount,isAdmin:b.problem.isAdmin}),showed:!1});var j=h[e];if(j.showed)try{j.item.getEl().slideUp(200,function(){j.item.destroy(),h[e]=null,M.pause(c)})}catch(k){j.item.destroy(),h[e]=null,M.pause(c)}else j.item.show(),j.showed=!0,M.pause(c)}}function v(){if(window.isLogin&&window.isActive){var b="发现一道争论性比较强的题目，要不你来帮忙看看吧？"+location.href;a.async("../../component/messageDialog",function(a){a.show({title:"发私信",content:b})})}}function w(a){var b=this,c=I(a.currentTarget);if(!M.mark(c)){var d=c.parents("div.answer-content"),e=d.attr("data-cmt-id"),f=b.cmtMap[e],g=b.problem.type,h=d.find("div.answer-brief"),i=I('<div class="editor-box"><div class="js-editor"></div><div class="txtarea-foot clearfix"><a class="btn float-right btn-primary btn-modify-sure" href="javascript:void(0);">确定</a><a class="btn btn-default float-right btn-modify-cancel" href="javascript:void(0);">取消</a></div></div>');h.replaceWith(i),i.find("a.btn-modify-cancel").one("click",function(){i.replaceWith(h),S.saveAnswerDraft({body:{entityId:b.problem.id,content:""}}),b._lastDraft=b.comment.draft="",M.clear(c)}),i.find("a.btn-modify-sure").on("click",function(a){function d(){if(!M.mark(k)){var a=I.trim(j.html());S.editAnswer({body:{content:a,commentId:e},call:function(){f.content=a,h.html(a),i.replaceWith(h),M.clear(c),M.clear(k),X.init(),b._lastDraft=b.comment.draft=""},error:function(a){Q.alert(a.msg),M.clear(k)}})}}var k=I(a.currentTarget),l=j.text();return l?(1!==g&&2!==g||!/^([a-z]|[A-Z]|[0-9]|\s|[,，、])+$/.test(l)?d():Q.confirm("除了答案外，还需要写清楚解题思路哦~~只写答案可能会被管理员删除的，确定现在提交吗",function(){d()}),void 0):(Q.alert("内容不能为空"),void 0)});var j=P.create(i.find(".js-editor").get(0),{height:180,toolbarFixedTop:W.getNavHeight(),noCodeSelect:!0,draftChange:function(a){S.saveAnswerDraft({body:{entityId:b.problem.id,content:a}}),b._lastDraft=a}});j.html(b._lastDraft||b.comment.draft||f.content)}}function x(a){function b(b){S.getRefAnswer({params:{questionId:c.problem.id},query:{captcha:b||null},call:function(a){d.content=a.data,d.isComplete=!0,c.firstCommentEl.find("div.answer-brief").html(a.data),X.init()},error:function(b){(1===b.code||2===b.code)&&(c.reqCaptcha=!0,x.call(c,a))}})}var c=this,d=c.comment.first;window.isLogin&&d&&!d.isComplete&&(c.reqCaptcha?Y.show({call:function(a){c.reqCaptcha=!1,b(a)}}):b())}function y(a){var b=this,c=I(a.target);window.isLogin&&(c.closest("div.subject-action").remove(),b.codeEditorEl.show(),"2"===b.codeJudgeType||2===b.codeJudgeType?b.initFECodeEditor():b.initCodeEditor())}function z(a){var b=this,c=I(a.currentTarget),d=c.parents("div.answer-content");!!d.attr("data-recommend");var e=d.attr("data-cmt-id"),f=b.cmtMap[e];d&&e&&f&&Q.confirm("确定设为参考答案？",function(){S.setRefAnswer({body:{commentId:e,questionId:b.problem.id},call:function(){b.popupRightAnswer(function(){window.location.reload()})},error:function(a){Q.alert(a.msg||N.tips.ajaxError)}})})}function A(a){var b=this,c=I(a.currentTarget),d=c.parents("div.answer-content");!!d.attr("data-recommend");var e=d.attr("data-cmt-id"),f=b.cmtMap[e];d&&e&&f&&Q.confirm("确定取消设为参考答案？",function(){S.unsetRefAnswer({body:{commentId:e},call:function(){Q.tips("操作成功",function(){window.location.reload()})},error:function(a){Q.alert(a.msg||N.tips.ajaxError)}})})}function B(){var b=this;I("#subject_upload").length>0&&window.isLogin&&(b.uploadEl=I("#subject_upload").parent(),b.uploadTxtEl=b.uploadEl.find("span.subject-upload-text"),b.progressEl=I("#jsUploadProgress"),b.runInfoEl=I("#subjectInfo"),a.async("../../util/upload",function(a){b.upload=new a({target:b,holderEl:I("#subject_upload"),type:N.uploadType.data,fileType:"*.txt",fileSizeLimit:2,fileQueueLimit:1,btn:{image:"/images/img/subject-upload-btn2.png",width:150,height:45},uploadSuccess:function(a,c){b.uploadFile=c,b.progressEl.html('<a href="javascript:void(0);" class="btn btn-large btn-block btn-primary"><span class="upload-rusult-ico"><span class="fui-check"></span></span>上传完成</a>'),b.uploadTxtEl.html("已上传"+c.fileName+"("+c.fileSize+")"),b.runDataMining(c)}})}))}function C(a){var b=this;T.submitDmInTerminal({body:{qid:b.problem.id,url:a.url},call:function(a){b.runTimer&&window.clearTimeout(b.runTimer),b.runTimer=setTimeout(function(){var c=arguments.callee;T.newDmStatus({query:{submissionId:a.submissionId},call:function(a){a=a||{};var d=a.status;if(5===d){var e=a.desc+"<br />"+a.memo;b.showMemo(e,"info"),b.runTimer=null}else{if(0===d||23===d||19===d||100===d){b.runTimer=setTimeout(c,500);var e=a.desc+"<br />"+a.memo;return b.showMemo(e,"info"),void 0}var e=a.desc+"<br />"+a.memo;b.showMemo(e),b.runTimer=null}},error:function(){b.showMemo("出现错误，请重试")}})},500)},error:function(){b.showMemo("出现错误，请重试")}})}function D(a,b){var c=this.runInfoEl;"info"===b?c.removeClass("alert-danger").addClass("alert-info"):c.removeClass("alert-info").addClass("alert-danger"),c.html(a.replace(/\n/g,"<br />")).show(),c.parent().show()}function E(a){var b=this,c=b.problem.type;return 1!==c&&2!==c&&3!==c?(a&&a(),void 0):(Q.show({title:"提示",content:"确认设为参考答案？",listeners:{render:function(){var a=this,d="";if(3===c)for(var e=0,f=b.problem.contentSize||0;f>e;e++)d+='<div style="margin-bottom:20px;"><input style="width:420px;" type="text" class="js-ipt" /></div>';else for(var g=b.problem.options,e=0,f=g.length;f>e;e++)d+=1===c?'<label style="display:inline-block;padding-right:10px;"><input style="width:20px" class="js-ipt" type="radio" value="'+g[e]+'" name="question">'+($[e]||e)+"</label>":'<label style="display:inline-block;padding-right:10px;"><input style="width:20px" class="js-ipt" type="checkbox" value="'+g[e]+'" />'+($[e]||e)+"</label>";a.popupContent.after('<div style="padding:20px;border-top:1px solid #ededed">'+d+"</div>")}},ok:function(){for(var d=this,e=d.getEl(),f=e.find("input.js-ipt"),g=[],h=3===c,i=0,j=f.length;j>i;i++)(h||I(f[i]).prop("checked"))&&g.push(I(f[i]).val());S.setRightAnswer({body:{questionId:b.problem.id,type:c,content:3===c?g.join("[$##$]"):null,rightOptions:3===c?null:1===c?g[0]:g.join(",")},call:function(){Q.tips("操作成功",a)},error:function(b){Q.tips(b.msg||"操作失败",a)}})},cancel:function(){a&&a()}}),void 0)}function F(){if(window.isLogin){var a=I("#jsEditorModuleBody");W.scrollToEl({el:a,animation:!0,ext:-I("div.nowcoder-header").height()-10}),W.highLight({el:a})}}function G(a){function b(a){var b=",isindex,fieldset,input,button,select,textarea,label,a,iframe,hr,ul,menu,div,blockquote,noscript,table,center,address,dir,pre,h5,dl,h4,noframes,h6,ol,h1,h3,h2,ins,del,script,style,b,acronym,bdo,var,#,abbr,code,br,i,cite,kbd,u,strike,s,tt,strong,q,samp,em,dfn,span,p,iframe,img,embed,noscript,br,kbd,center,button,basefont,h5,h4,samp,h6,ol,h1,h3,h2,form,font,#,select,menu,ins,abbr,label,code,table,script,cite,input,iframe,strong,textarea,noframes,big,small,span,hr,sub,bdo,var,div,object,sup,strike,dir,map,dl,applet,del,isindex,fieldset,ul,b,acronym,a,blockquote,i,u,s,tt,address,q,pre,p,em,dfn,tr,#,param,form,li,ol,ul,style,script,base,link,meta,title,head,body,html,address,blockquote,center,dir,div,dl,fieldset,form,h1,h2,h3,h4,h5,h6,hr,isindex,menu,noframes,ol,p,pre,table,ul,area,base,basefont,br,col,command,dialog,embed,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr,";return a=a.replace(/\n/gi,"").replace(/<p.*?>/gi,"").replace(/<div.*?>/gi,"").replace(/<span.*?>/gi,"").replace(/<br.*?>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<\/div>/gi,"\n").replace(/\n{2,}/gi,"\n\n").replace(/<(.*?)>/gi,function(a,c){var d=I.trim(c);return d=d.replace(/^\//g,""),-1!==b.indexOf(","+d+",")?"":"<"+c+">"})}var c=this,d=I(a.currentTarget),e=d.parents("div.answer-content"),f=e.find("div.answer-brief"),g=e.attr("data-cmt-id"),h=c.cmtMap[g],i=h.content,j=I("<div>"+i+"</div>");if(j.find("pre.prettyprint").length>0)return Q.alert("回复中存在格式化后的代码，请手动编辑"),void 0;var k=b(i);k='<pre class="prettyprint">'+k+"</pre>",new Q({title:"效果预览",content:k,width:600,ok:function(){S.editAnswer({body:{content:k,commentId:g},call:function(){h.content=k,f.html(k),X.init()},error:function(a){Q.alert(a.msg)}})},cancel:function(){},listeners:{render:function(){X.init()}}})}function H(a){function b(a){var b=I("#jsAnswerBox"),c="";1===e||2===e?(c="<span>正确答案：</span>",J.each(a,function(a,b){a.isRight&&(c+=$[b]+" ")})):3===e&&(c="<dl><dt>正确答案：</dt>",J.each(a,function(a,b){c+='<dd><span class="blank-num">'+(b+1)+"</span> "+(a.content||"")+"</dd>"}),c+="</dl>"),b.html(c),d.slideUp(120,function(){b.slideDown(120)})}var c=this,d=I(a.currentTarget),e=c.problem.type;return!window.isLogin||1!==e&&2!==e&&3!==e?void 0:c.sysRightAnswerData?(b(c.sysRightAnswerData),void 0):(Y.show({title:"输入验证码即可查看答案",type:N.captcha.sysRightAnswer,call:function(a){U.getRightOptions({query:{questionId:c.problem.id,captcha:a},call:function(a){c.sysRightAnswerData=a.data,b(a.data)},error:function(a){Q.alert(a.msg)},always:function(){}})}}),void 0)}var I=a("../../lib/jquery"),J=a("../../lib/underscore"),K=a("../../core/base"),L=a("../../util/util"),M=a("../../util/limit"),N=a("../../core/siteConfig"),O=a("../../component/subComment"),P=a("../../util/ke"),Q=a("../../component/popup"),R=a("../../component/popupCommon"),S=a("../../action/contest"),T=a("../../action/code"),U=a("../../action/question"),V=a("../../util/browser"),W=a("../../util/dom"),X=a("../../util/highlighter"),Y=a("../../component/popupCaptcha"),Z=a("../../util/littleAction"),$="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),_=56;K.ready({initialize:b,uploadFileId:[],binds:{"scroll window":d,"click a.click-more-comment":k,"click a.click-pub-point":l,"click button.run-code":m,"click button#beginChallenge":y,"click #jsDealAnswer":F,"click #jsShowSysAnswer":H},events:{"click span.q-share-to a.share-wx":n,"click a.js-click-ask":o,"click a.click-like":p,"click a.click-del":t,"click a.click-reply":u,"click a.click-invite":v,"click div.answer-legend a.click-edit":w,"click a.show-ref-answer":x,"click a.click-set-referanswer":z,"click a.click-unset-referanswer":A,"click button.click-like":q,"click button.click-dislike":r,"click div.answer-brief img":s,"click a.js-click-pertty":G},focusDiscuss:c,initEditor:e,initCodeEditor:f,initFECodeEditor:g,renderCmt:h,renderCmtList:i,getCmtStr:j,initUpload:B,runDataMining:C,showMemo:D,popupRightAnswer:E})});
